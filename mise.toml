[tools]
go = "1.25.7"
golangci-lint = "latest"
shellcheck = "latest"
actionlint = "latest"

[tasks]
"lint:go" = "golangci-lint run"
"lint:shell" = "shellcheck make_release"
"lint:github" = "actionlint"
lint = { depends = ["lint:*"] }

"fmt:go" = "go fmt ./..."
fmt = { depends = ["fmt:*"] }

test = "go test -count=1 ./..."

install = "go mod download"

codegen = "true"

ci = { depends = ["lint", "test", "build"] }

build = """
#!/usr/bin/env bash
mkdir -p build
go tool dist list | grep -vE 'wasm|aix|plan9|android|ios|illumos|solaris|dragonfly' | while IFS=/ read -r GOOS GOARCH; do
  echo "Building $GOOS/$GOARCH"
  env GOOS="$GOOS" GOARCH="$GOARCH" go build -v -o "build/ts-proxyd-$GOOS-$GOARCH" ./cmd/ts-proxyd
done
"""

"docker:build" = "docker build -t ts-proxyd ."
"docker:push" = "echo 'Docker push should be handled in CI with proper credentials'"
